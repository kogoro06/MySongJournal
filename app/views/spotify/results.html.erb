<div class="min-h-screen bg-customblue text-black flex flex-col items-center pt-8 pb-8">
  <div class="bg-white p-6 rounded shadow-md w-full max-w-7xl">
    <!-- ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold flex items-center gap-2">
        <%= image_tag 'spotify.png', alt: 'Spotify Logo', class: 'h-8 w-8' %>
        æ¤œç´¢çµæœ
      </h1>
    </div>

    <% if @tracks.present? %>
      <!-- æ¤œç´¢çµæœæ•°ã®è¡¨ç¤º -->
      <% if @total_count&.positive? %>
        <div class="text-gray-600 text-sm mb-4">
          å…¨<%= @total_count %>ä»¶ä¸­ <%= @tracks.offset_value + 1 %>-<%= @tracks.offset_value + @tracks.count %>ä»¶ã‚’è¡¨ç¤º
          æ¤œç´¢æ¡ä»¶:
          <span class="text-blue-500 font-bold">
            <%= query_string.presence || 'ç‰¹ã«ãªã—' %>
          </span>
        </div>
      <% end %>

      <!-- æ¤œç´¢çµæœä¸€è¦§ -->
      <div class="grid grid-cols-2 gap-4">
        <% @tracks.each do |track| %>
          <div class="bg-gray-300 rounded-lg shadow h-full flex flex-col p-4">
            <!-- Spotify Player -->
            <div class="relative mb-4">
              <iframe style="border-radius:12px" 
                      src="https://open.spotify.com/embed/track/<%= track[:spotify_track_id] %>" 
                      width="100%"
                      height="352"
                      frameBorder="0" 
                      allowfullscreen="" 
                      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                      loading="lazy"
                      class="w-full rounded-lg">
              </iframe>
            </div>

            <!-- æ›²æƒ…å ± -->
            <div class="space-y-3">
              <div class="flex items-center gap-2">
                <span class="w-6 flex-shrink-0 text-xl">ğŸµ</span>
                <span class="text-lg font-bold truncate"><%= track[:song_name] %></span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-6 flex-shrink-0 text-xl">ğŸ¤</span>
                <span class="text-lg font-medium truncate"><%= track[:artist_name] %></span>
              </div>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="mt-auto">
              <%= button_to select_tracks_path(
                    selected_track: {
                      song_name: track[:song_name],
                      artist_name: track[:artist_name],
                      album_image: track[:album_image],
                      preview_url: track[:preview_url],
                      spotify_track_id: track[:spotify_track_id],
                    }.to_json
                  ), 
                  method: :post, 
                  class: "w-full" do %>
                <button type="submit" class="w-full text-center py-2 px-4 bg-gray-500 text-white text-sm rounded hover:bg-gray-600">
                  é¸æŠ
                </button>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
      <% if @tracks.total_pages > 1 %>
        <div class="mt-6">
          <%= paginate @tracks %>
        </div>
      <% end %>
    <% else %>
      <div class="bg-gray-100 p-8 rounded shadow text-center">
        <p class="text-gray-600 text-lg">æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
      </div>
    <% end %>

    <!-- å†æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="mt-6">
      <div class="bg-gray-300 rounded-lg shadow p-4">
        <%= render partial: 'spotify/search' %>
      </div>
    </div>
  </div>
</div>

<style>
  .pagination {
    @apply flex justify-center gap-2;
  }
  .pagination span {
    @apply inline-block;
  }
  .pagination .page {
    @apply px-4 py-2 bg-gray-500 text-white font-medium rounded shadow-md hover:bg-gray-600 text-center text-sm;
  }
  .pagination .page.current {
    @apply bg-customred;
  }
  .pagination .prev, .pagination .next {
    @apply px-4 py-2 bg-gray-500 text-white font-medium rounded shadow-md hover:bg-gray-600 text-center text-sm;
  }
  .pagination .gap {
    @apply px-2 text-gray-600;
  }
</style>
